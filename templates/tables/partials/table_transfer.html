{% load i18n %}

<!-- OOB Tabbar Update -->
<ion-footer hx-swap-oob="innerHTML:#section-tabbar">
{% include "tables/partials/tabbar.html" with current_view='floor' %}
</ion-footer>

<ion-content class="ion-padding">
    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <ion-button
            fill="clear"
            hx-get="{% url 'tables:floor_view' %}"
            hx-target="#dashboard-content"
            hx-push-url="true">
            <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
        </ion-button>
        <div>
            <h1 class="text-2xl font-bold text-gray-900">{% trans "Transfer Sale" %}</h1>
            <p class="text-gray-500">
                {% trans "From Table" %} {{ table.number }}
                {% if table.area %} ({{ table.area.name }}){% endif %}
            </p>
        </div>
    </div>

    <ion-card>
        <ion-card-header>
            <ion-card-title>{% trans "Select Target Table" %}</ion-card-title>
            <ion-card-subtitle>{% trans "Choose an available table to transfer the sale" %}</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
            <form method="post"
                hx-post="{% url 'tables:table_transfer' pk=table.pk %}"
                hx-target="#dashboard-content">
                {% csrf_token %}

                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-6">
                    {% for target in available_tables %}
                    <label class="cursor-pointer">
                        <input type="radio" name="target_table" value="{{ target.pk }}" class="hidden peer">
                        <div class="bg-green-50 border-2 border-green-400 rounded-lg p-4 text-center transition-all
                                    peer-checked:border-blue-500 peer-checked:bg-blue-100 peer-checked:ring-2 peer-checked:ring-blue-500
                                    hover:bg-green-100">
                            <div class="text-2xl font-bold text-green-700">{{ target.number }}</div>
                            {% if target.name %}
                            <div class="text-xs text-gray-600">{{ target.name }}</div>
                            {% endif %}
                            {% if target.area %}
                            <div class="text-xs text-gray-500 mt-1">{{ target.area.name }}</div>
                            {% endif %}
                            <div class="text-xs text-gray-400">
                                <ion-icon name="people"></ion-icon> {{ target.capacity }}
                            </div>
                        </div>
                    </label>
                    {% empty %}
                    <div class="col-span-full text-center py-8">
                        <ion-icon name="grid-outline" class="text-6xl text-gray-300 mb-4"></ion-icon>
                        <p class="text-gray-500">{% trans "No available tables" %}</p>
                    </div>
                    {% endfor %}
                </div>

                {% if available_tables %}
                <!-- Current Sale Info -->
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <h4 class="font-medium text-gray-700 mb-2">{% trans "Current Sale Info" %}</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">{% trans "Guests:" %}</span>
                            <span class="font-medium">{{ table.guests }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">{% trans "Time:" %}</span>
                            <span class="font-medium">{{ table.elapsed_display }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">{% trans "Waiter:" %}</span>
                            <span class="font-medium">{{ table.waiter|default:"-" }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">{% trans "Total:" %}</span>
                            <span class="font-medium">{{ table.current_total }} &euro;</span>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex justify-end gap-3">
                    <ion-button
                        fill="outline"
                        color="medium"
                        hx-get="{% url 'tables:floor_view' %}"
                        hx-target="#dashboard-content"
                        hx-push-url="true">
                        {% trans "Cancel" %}
                    </ion-button>
                    <ion-button type="submit">
                        <ion-icon slot="start" name="swap-horizontal"></ion-icon>
                        {% trans "Transfer Sale" %}
                    </ion-button>
                </div>
                {% endif %}
            </form>
        </ion-card-content>
    </ion-card>
</ion-content>
