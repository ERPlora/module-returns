{% load i18n %}

<!-- OOB Tabbar Update -->
<ion-footer hx-swap-oob="innerHTML:#section-tabbar">
{% include "tables/partials/tabbar.html" with current_view='tables' %}
</ion-footer>

<ion-content class="ion-padding">
    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <ion-button
            fill="clear"
            hx-get="{% url 'tables:floor_view' %}"
            hx-target="#dashboard-content"
            hx-push-url="true">
            <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
        </ion-button>
        <div class="flex-grow">
            <h1 class="text-2xl font-bold text-gray-900">{% trans "Table" %} {{ table.number }}</h1>
            <p class="text-gray-500">
                {% if table.area %}{{ table.area.name }}{% endif %}
                {% if table.name %} - {{ table.name }}{% endif %}
            </p>
        </div>
        <ion-badge
            {% if table.status == 'available' %}color="success"{% endif %}
            {% if table.status == 'occupied' %}color="danger"{% endif %}
            {% if table.status == 'reserved' %}color="warning"{% endif %}
            {% if table.status == 'blocked' %}color="medium"{% endif %}>
            {{ table.get_status_display }}
        </ion-badge>
    </div>

    <!-- Table Info -->
    <ion-card class="mb-4">
        <ion-card-content>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div>
                    <div class="text-2xl font-bold text-gray-800">{{ table.capacity }}</div>
                    <div class="text-sm text-gray-500">{% trans "Capacity" %}</div>
                </div>
                {% if table.status == 'occupied' %}
                <div>
                    <div class="text-2xl font-bold text-gray-800">{{ table.guests }}</div>
                    <div class="text-sm text-gray-500">{% trans "Guests" %}</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-gray-800">{{ table.elapsed_display }}</div>
                    <div class="text-sm text-gray-500">{% trans "Time" %}</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-red-600">{{ table.current_total }} &euro;</div>
                    <div class="text-sm text-gray-500">{% trans "Total" %}</div>
                </div>
                {% endif %}
            </div>
        </ion-card-content>
    </ion-card>

    <!-- Actions -->
    <ion-card>
        <ion-card-header>
            <ion-card-title>{% trans "Actions" %}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <div class="flex flex-wrap gap-3">
                {% if table.status == 'available' %}
                <ion-button
                    hx-get="{% url 'tables:table_open' pk=table.pk %}"
                    hx-target="#dashboard-content"
                    hx-push-url="true">
                    <ion-icon slot="start" name="play"></ion-icon>
                    {% trans "Open Table" %}
                </ion-button>
                <form method="post" hx-post="{% url 'tables:table_block' pk=table.pk %}">
                    {% csrf_token %}
                    <ion-button fill="outline" color="medium" type="submit">
                        <ion-icon slot="start" name="lock-closed"></ion-icon>
                        {% trans "Block" %}
                    </ion-button>
                </form>
                {% elif table.status == 'occupied' %}
                <ion-button
                    hx-get="/modules/sales/?table={{ table.pk }}"
                    hx-target="#dashboard-content"
                    hx-push-url="true">
                    <ion-icon slot="start" name="cart"></ion-icon>
                    {% trans "View Sale" %}
                </ion-button>
                <ion-button
                    fill="outline"
                    hx-get="{% url 'tables:table_transfer' pk=table.pk %}"
                    hx-target="#dashboard-content"
                    hx-push-url="true">
                    <ion-icon slot="start" name="swap-horizontal"></ion-icon>
                    {% trans "Transfer" %}
                </ion-button>
                {% elif table.status == 'blocked' %}
                <form method="post" hx-post="{% url 'tables:table_unblock' pk=table.pk %}">
                    {% csrf_token %}
                    <ion-button color="warning" type="submit">
                        <ion-icon slot="start" name="lock-open"></ion-icon>
                        {% trans "Unblock" %}
                    </ion-button>
                </form>
                {% endif %}

                <ion-button
                    fill="outline"
                    hx-get="{% url 'tables:table_edit' pk=table.pk %}"
                    hx-target="#dashboard-content"
                    hx-push-url="true">
                    <ion-icon slot="start" name="create-outline"></ion-icon>
                    {% trans "Edit" %}
                </ion-button>
            </div>
        </ion-card-content>
    </ion-card>
</ion-content>
