{% load i18n component_tags %}

{% if request.htmx %}
{% component "tabbar" module_id="returns" current_view="returns" oob=True %}{% endcomponent %}
{% endif %}

<ion-content class="ion-padding">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">{% trans "Returns" %}</h1>
            <p class="text-gray-500">{% trans "All return transactions" %}</p>
        </div>
        <ion-button
            hx-get="{% url 'returns:return_create' %}"
            hx-target="#main-content-area"
            hx-push-url="true">
            <ion-icon slot="start" name="add"></ion-icon>
            {% trans "New Return" %}
        </ion-button>
    </div>

    <!-- Filters -->
    <ion-card class="mb-4">
        <ion-card-content>
            <div class="flex flex-wrap gap-2">
                <ion-button
                    fill="{% if not status_filter %}solid{% else %}outline{% endif %}"
                    size="small"
                    hx-get="{% url 'returns:return_list' %}"
                    hx-target="#main-content-area"
                    hx-push-url="true">
                    {% trans "All" %}
                </ion-button>
                <ion-button
                    fill="{% if status_filter == 'pending' %}solid{% else %}outline{% endif %}"
                    size="small"
                    color="warning"
                    hx-get="{% url 'returns:return_list' %}?status=pending"
                    hx-target="#main-content-area"
                    hx-push-url="true">
                    {% trans "Pending" %}
                </ion-button>
                <ion-button
                    fill="{% if status_filter == 'approved' %}solid{% else %}outline{% endif %}"
                    size="small"
                    color="primary"
                    hx-get="{% url 'returns:return_list' %}?status=approved"
                    hx-target="#main-content-area"
                    hx-push-url="true">
                    {% trans "Approved" %}
                </ion-button>
                <ion-button
                    fill="{% if status_filter == 'processed' %}solid{% else %}outline{% endif %}"
                    size="small"
                    color="success"
                    hx-get="{% url 'returns:return_list' %}?status=processed"
                    hx-target="#main-content-area"
                    hx-push-url="true">
                    {% trans "Processed" %}
                </ion-button>
            </div>
        </ion-card-content>
    </ion-card>

    <!-- Returns List -->
    <ion-card>
        <ion-card-content class="p-0">
            {% if returns %}
            <ion-list>
                {% for return in returns %}
                <ion-item
                    button
                    hx-get="{% url 'returns:return_detail' pk=return.pk %}"
                    hx-target="#main-content-area"
                    hx-push-url="true">
                    <ion-label>
                        <h2 class="font-medium">{{ return.return_number }}</h2>
                        <p class="text-sm text-gray-500">
                            {{ return.created_at|date:"d/m/Y H:i" }}
                            {% if return.reason %} - {{ return.reason.name }}{% endif %}
                        </p>
                    </ion-label>
                    <ion-badge slot="end"
                        {% if return.status == 'pending' %}color="warning"{% endif %}
                        {% if return.status == 'approved' %}color="primary"{% endif %}
                        {% if return.status == 'processed' %}color="success"{% endif %}
                        {% if return.status == 'cancelled' %}color="medium"{% endif %}>
                        {{ return.get_status_display }}
                    </ion-badge>
                    <ion-note slot="end" class="ml-2 font-medium">{{ return.total_amount }} &euro;</ion-note>
                </ion-item>
                {% endfor %}
            </ion-list>

            <!-- Pagination -->
            {% if returns.has_other_pages %}
            <div class="flex justify-center gap-2 p-4 border-t">
                {% if returns.has_previous %}
                <ion-button
                    fill="outline"
                    size="small"
                    hx-get="{% url 'returns:return_list' %}?page={{ returns.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}"
                    hx-target="#main-content-area">
                    <ion-icon name="chevron-back"></ion-icon>
                </ion-button>
                {% endif %}
                <span class="flex items-center px-3">
                    {{ returns.number }} / {{ returns.paginator.num_pages }}
                </span>
                {% if returns.has_next %}
                <ion-button
                    fill="outline"
                    size="small"
                    hx-get="{% url 'returns:return_list' %}?page={{ returns.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}"
                    hx-target="#main-content-area">
                    <ion-icon name="chevron-forward"></ion-icon>
                </ion-button>
                {% endif %}
            </div>
            {% endif %}
            {% else %}
            <div class="text-center py-12 text-gray-500">
                <ion-icon name="return-down-back-outline" class="text-5xl mb-4"></ion-icon>
                <p class="mb-4">{% trans "No returns found" %}</p>
                <ion-button
                    hx-get="{% url 'returns:return_create' %}"
                    hx-target="#main-content-area"
                    hx-push-url="true">
                    <ion-icon slot="start" name="add"></ion-icon>
                    {% trans "Create First Return" %}
                </ion-button>
            </div>
            {% endif %}
        </ion-card-content>
    </ion-card>
</ion-content>
